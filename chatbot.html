<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>聊天机器人</title>
    <style type="text/css">
        #bg {
        }
        #tittle {
            font-family: 楷体,serif;
            text-align: center;
        }
        #chat {
            font-size: x-large;
        }
        #send {
        }
    </style>
</head>
<body bgcolor="#f5f5dc">
<div id="bg">
    <div id="tittle">
        <h1>简易聊天机器人</h1>
    </div>
    <div id="chat">
        Robot: Hello, world! :)<br>
    </div>
    <div id="send">
        <label>
            <input type="text" id="input" placeholder='点击"发送"或"Enter"发送你想说的话!'>
            <input type="button" onclick="send()" width="2000px" value="发送">
        </label>
    </div>
</div>
<script>
    //绑定键盘Enter键
    document.onkeydown = function (ev) {
        if(ev.keyCode === 13){
            send()
        }
    }
    let session = Math.random().toString(); //获取一个session
    function replace(text) {
        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function(){
            if (xhr.readyState === 4 && xhr.status === 200){
                let rep = JSON.parse(xhr.responseText);
                if (rep['code'] === 0)
                    document.getElementById("chat").innerText += "Robot: " + rep['replace'] + "\n";
                else
                    document.getElementById("chat").innerText += "Robot: " + "出错了!" + "\n";
            }
        }
        xhr.open("GET","http://mjyzz.club/chatbot.php?" + "session=" + session +"&mesg=" + text,true);
        xhr.send();
    }
    function send() {
        let text = document.getElementById("input").value;
        document.getElementById("input").value = ""; //清空
        document.getElementById("chat").innerText += "You: " + text + "\n"; //回显
        replace(text);
    }
</script>
</body>
</html>